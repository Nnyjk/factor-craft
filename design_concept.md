# Factor Craft 核心设计文档（扩展版）

## 1. 核心概念：Factor (因子)

Factor 是某种充斥在维度中的能量或法则的具象化数值。它不是静态的，而是像潮汐一样随着世界时间（World Time）不断波动。

---

## 1.1 数值模型

Factor 值 $F(t)$ 是一个维度全局的浮点数值，通常范围在 $[0, 100]$ 之间，但也可能溢出或下溢（代表极端危险状态）。

计算公式原型：
$$ F(t) = F_{base} + F_{tide}(t) + F_{player} + F_{random} $$

* $F_{base}$: 维度的基准值（例如主世界 50，下界 80，末地 20）。
* $F_{tide}(t)$: 潮汐波动，通常是一个复合正弦波函数。
  * $$ A \cdot \sin(\frac{t}{T} \cdot 2\pi) $$
  * $A$: 振幅 (Amplitude)
  * $T$: 周期 (Period)，建议采用 **96000~192000 tick（4~8 天）**，拉长波动周期。
* $F_{player}$: 玩家设施产生的偏移量总和。
* $F_{random}$: 随机扰动/噪声。

### 1.1.1 进阶模型参数（用于平衡）

* **阻尼系数 D**：当玩家持续高强度干预时，系统自动增加阻尼，抑制继续拉高/拉低（防止滚雪球）。
* **惯性系数 I**：Factor 不立即响应输入，而是存在延迟（用于制造“预判窗口”玩法）。
* **维度耦合 C**：跨维度设备会引入耦合项，允许“主世界抽取下界活性能量”但产生副作用。

推荐离散更新（每 tick）：
$$ F_{t+1} = F_t + \Delta_{tide} + \Delta_{player} + \Delta_{random} - D(F_t - F_{base}) $$

### 1.1.2 节奏控制（慢节奏方案）

为减缓游戏节奏，状态并非每 tick 立即切换，而是采用“数值连续更新、阶段离散判定”：

* **Factor 数值实时更新**：用于机器效率、HUD 波形、局部事件。
* **阶段变化仅在新的一天开始时检测**：即每天 `world time % 24000 == 0` 时，根据过去一日平均值 `F_{dayAvg}` 决定 Tier。
* **阈值事件延迟结算**：边界事件在日切时统一触发，防止频繁抖动导致玩法割裂。

推荐日切判定：
$$ Tier_{day+1} = f(F_{dayAvg}, F_{trend}, H) $$

其中 `H` 为迟滞参数（Hysteresis），例如升阶阈值 +3、降阶阈值 -3，避免临界值反复横跳。

---

## 1.2 状态划分 (Factor Tiers)

根据 Factor 的当前值，维度处于不同的状态：

| 范围 | 状态名称 | 描述 | 环境影响 (Cons) | 玩家收益 (Pros) |
| :--- | :--- | :--- | :--- | :--- |
| < 10 | **枯竭 (Depleted)** | 能量极度匮乏 | 魔法机器停转，作物生长停滞 | **安全期**：怪物生成率降至 0，敌对生物变中立，适合建筑和维护 |
| 10 - 30 | **低能 (Low)** | 能量稀薄 | 机器效率降低 (-50%) | 精密操作成功率提升，燃料消耗降低 |
| 30 - 70 | **稳定 (Stable)** | 正常水平 | 无特殊影响 | 标准合成效率 |
| 70 - 90 | **高能 (High)** | 能量充盈 | 敌对生物获得 Buff，偶尔出现环境辐射（需防护） | 机器效率提升 (+50%)，产出增加 |
| > 90 | **过载 (Overload)** | 能量暴走 | 频繁生成元素怪物，玩家受到持续魔力压制（Debuff） | **奇迹时刻**：允许进行神级注魔，产出翻倍，稀有掉落率 100% |

### 1.2.1 边界事件（Threshold Events）

当跨越关键阈值时触发事件，提高局势戏剧性：

* **30 → 70（升阶）**：触发“活化风暴”，短时提高世界掉落质量。
* **70 → 90（升阶）**：触发“裂隙预兆”，刷新小型裂隙与精英怪。
* **90+ 持续 3 分钟**：触发“失稳共鸣”，出现区域性地形污染（可净化）。
* **回落至 30~70**：触发“回稳奖励”，给与一次性稳定芯片/修复材料。

> 注：以上事件触发资格在日内累计，但正式结算与广播在“新的一天”统一执行。

---

## 2. 核心玩法循环

### 阶段 1: 适应 (Survival)
* 玩家进入游戏，Factor 处于自然潮汐状态。
* 玩家需要制作基础工具 `Factorometer` (因子计) 来观测当前的 Factor 值。
* **策略**：在 Factor 高时通过战斗获取资源，在 Factor 低时进行探索或种田。
* **挑战**：Factor 过高时的环境伤害或强力怪物。

### 阶段 2: 交互 (Interaction)
* 玩家制造基础机器。
* **Factor Consumer (因子消耗器)**：利用高 Factor 进行生产（如矿物倍增），但会局部或全局降低 Factor。
* **Factor Accumulator (因子收集器)**：在低 Factor 时释放储存的能量来维持机器运行。

### 阶段 3: 掌控 (Control)
* 玩家制造大型多方块结构。
* **World Stabilizer (维度稳定器)**：消耗大量资源，将维度的 Factor 锁定在特定范围。
* **Tide Agitator (潮汐激荡器)**：人为制造“Factor 巨浪”，瞬间将 Factor 推至极高值以进行终极合成，随后可能导致长时间“枯竭期”。

### 阶段 4: 重构 (Reshape)
* 玩家开始跨维度工程，构建“输入维度 → 转化维度 → 输出维度”产业链。
* 解锁**维度协议**与**法则签名**系统，可将某维度特性注入机器配方。
* 目标从“生存”转向“生态治理”：让整个服务器的潮汐处于可控状态。

---

## 3. 扩展设定：世界观与叙事骨架

### 3.1 世界观前提

Factor 并非能源本身，而是“现实稳定度”的表现。古代文明“Arbiter”曾通过巨构维持三维度平衡，但最终因过度提取导致崩解。玩家扮演“继承者”，需要在利用与修复之间做选择。

### 3.2 阵营（可选系统）

* **守衡者（Wardens）**：偏稳定派。擅长防护、修复、农业增益。
* **裂潮者（Riftbreakers）**：偏爆发派。擅长过载战斗、稀有掉落、极限合成。
* **虚序会（Null Order）**：偏末地技术。擅长存储、冻结、精准控制。

阵营可提供：
* 独占任务线。
* 独占工具模块（例如不同的稳定器升级方向）。
* 不同结局文本与成就。

### 3.3 主线章节（建议）

1. **听见潮汐**：学会观测。
2. **第一次失稳**：经历一次可控灾害教学。
3. **维度开口**：建立下界/末地传输节点。
4. **古代回声**：发现 Arbiter 遗迹并解析蓝图。
5. **最终抉择**：稳定世界（保守结局）或重塑世界（激进结局）。

---

## 4. 维度差异性设计 (Dimensional Variance)

Factor 不仅仅是一个通用数值，它在不同维度表现出截然不同的物理性质。

### 4.1 主世界 (The Overworld) - 谐波 (Harmonic)
* **特性**: 完美正弦波，周期稳定（与日夜交替同步）。
* **关键词**: 平衡、循环、生命。
* **Factor 曲线**: 平滑，无突变。
* **适宜活动**: 基础自动化、农业加速、稳定充能。
* **环境影响**:
  * 高 Factor: 作物生长极快，被动生物繁殖加速。
  * 低 Factor: 类似冬季，作物休眠。

### 4.2 下界 (The Nether) - 混沌 (Chaotic)
* **特性**: 剧烈波动，平均值较高，伴随随机能量尖峰 (Spikes)。
* **关键词**: 爆发、危险、热能。
* **Factor 曲线**: 锯齿状，不可预测，偶尔出现极值（Overload）。
* **适宜活动**: 快速充能（需稳压设备）、高能合成、稀有战斗掉落。
* **环境影响**:
  * 高 Factor: 熔岩流动速度加快，火焰伤害加倍，猪灵狂暴。
  * 低 Factor: 灵魂沙减速效果增强，视野变暗。

### 4.3 末地 (The End) - 虚空 (Void)
* **特性**: 极低基准值，近乎静滞，对外界干扰反应迟钝（高阻尼）。
* **关键词**: 寂静、存储、熵增。
* **Factor 曲线**: 近乎直线，极难自然恢复。
* **适宜活动**: 长期能量存储（低泄漏）、危险废料排放（消除过剩 Factor）、精密实验。
* **环境影响**:
  * 高 Factor (人为): 末影人瞬移频率极高，可能导致虚空伤害。
  * 低 Factor: 重力减弱（跳跃提升）。

### 4.4 维度联动事件

* **主世界高能 + 下界过载**：触发“赤潮入侵”，主世界夜晚刷出火系裂隙怪。
* **末地长期低能**：触发“静默窗”，全服务器机器故障率下降（鼓励大规模维护）。
* **三维度同处稳定区间**：触发“黄金潮”，全局经验与附魔效率提升。

---

## 5. 魔法科技体系 (Techno-Magic System)

本模组不使用传统线缆和管道，而是采用“场”与“流”的概念。

### 5.1 传输介质
1. **晶体共振 (Resonance)**: 短距离无线传输。机器插槽中放入调谐晶体，与附近 `Pylon` (塔) 共振。
2. **以太光束 (Ether Beam)**: 长距离点对点传输。可用透镜 (Lens) 折射；光束穿过实体会造成效果。
3. **相位管道 (Phase Duct)**: 输送高浓度液态 Factor（顶级合成专用）。

### 5.2 核心设备
* **Factorometer (因子计)**: HUD+手持双模式，显示数值、趋势箭头、下一阶段 ETA。
* **Resonator (共振器)**: 基础发电机，利用自然波动差发电（RF/FE）。
* **Stabilizer (稳定锚)**: 多方块结构，锁定区块潮汐。
* **Rift Projector (裂隙投射器)**: 终极设备，引入维度属性，创造“人造生物群系”。

### 5.3 模块化改造（玩法深度）

每台核心机器有 3 个模块槽：
* **效率槽**：提高处理速度，增加失稳风险。
* **稳压槽**：降低风险，牺牲峰值产能。
* **专精槽**：注入维度属性（例如下界专精=战利品倾向，末地专精=精准产出）。

---


### 5.4 多方块机器体系（扩展）

围绕“中枢 + 框架 + 功能舱”的多方块逻辑，提供可扩展工厂化体验：

1. **Harmonic Foundry（谐波铸造阵）**
   * 作用：在稳定/高能区执行批量冶炼与合金化。
   * 结构：3x3x4 主体，底层耐热砖，中层共振线圈，顶层控制核心。
   * 特点：支持“连铸模式”，连续处理但更依赖稳定度。

2. **Aether Distiller（以太蒸馏塔）**
   * 作用：把液态 Factor 精炼为不同纯度馏分（燃料级/注魔级/反应级）。
   * 结构：2x2x6 立式塔体，可向上扩展塔节提升产率。
   * 特点：塔节越高越吃稳压，适合中后期服务器工业区。

3. **Rift Loom（裂隙织机）**
   * 作用：将维度签名与材料胚体绑定，生产高阶功能部件。
   * 结构：5x5 平台 + 四角锚塔 + 中央织机核心。
   * 特点：跨维度加成明显，但失稳时有概率“签名污染”。

4. **Null Vault（虚序封存库）**
   * 作用：长期存储高浓度 Factor 与危险副产物，降低泄漏。
   * 结构：3x3x3 封闭腔体 + 外环稳定框。
   * 特点：可当作“服务器电网缓冲器”，削峰填谷。

5. **Tide Crucible（潮汐反应釜）**
   * 作用：在过载窗口执行终极合成（神器胚、Boss 召唤物）。
   * 结构：圆环式 7x7（近似）祭坛 + 三层导流环。
   * 特点：高收益高风险，必须搭配紧急泄压模块。

### 5.5 多方块强化模块（附加升级）

每个多方块核心支持 4 类强化插槽：

* **结构模块（Structure）**：
  * `Reinforced Frame`：提升结构容错，减少缺块导致停机。
  * `Adaptive Brace`：自动重配流路，降低过载炸机概率。
* **流程模块（Process）**：
  * `Parallel Chamber`：并行处理 +1~+3 通道，显著提升吞吐。
  * `Catalyst Matrix`：缩短单次工艺时长，增加催化剂消耗。
* **稳定模块（Stability）**：
  * `Phase Damper`：降低波动输入，牺牲峰值效率换稳定。
  * `Entropy Sink`：吸收异常脉冲，需定期排空。
* **维度模块（Dimensional）**：
  * `Nether Manifold`：提高战斗类产物和热工配方收益。
  * `End Lattice`：提高精密合成成功率和品质下限。

模块可叠加但有“功率预算上限”，超限会触发降频运行，防止无脑堆叠。

## 6. 玩法系统补全

### 6.1 风险-收益系统（Risk/Reward）

* 玩家可主动把机器运行在“阈值边缘”（如 88~92）。
* 在危险区间持续运行可累积“共鸣倍率”。
* 一旦失控将触发故障链：停机、污染、怪潮。
* 通过紧急关断、冗余稳压可部分对冲风险。

### 6.2 污染与修复系统

* 过载行为产生 **Factor 污染块**（降低周边生物群系质量）。
* 污染可通过：净化塔、植物修复、末地排放协议清除。
* 修复行为可积累“生态声望”，解锁守衡者路线奖励。

### 6.3 战斗系统

新增敌对单位类型：
* **潮涌体**：在高能区生成，弱点会随潮汐变化。
* **裂隙编织者**：召唤局部小潮汐，打乱玩家节奏。
* **零熵守卫**：末地精英，免疫多数异常，掉落顶级稳定材料。

Boss 设计方向：
* **The Arbiter Echo（仲裁回响）**：会强制改写战场 Factor 分段，要求玩家边打边控场。

### 6.4 合成与经济循环

* 高阶配方不再只看“材料数量”，而是看“**潮汐窗口** + **结构完整度** + **输入维度签名**”。
* 形成可交易资源：
  * 稳态凭证（服务于服务器维护团队）
  * 过载残渣（服务于战斗玩家）
  * 维度签名晶片（服务于工程玩家）

---

## 7. 发展路线 (Progression)

1. **观察者时代**: 制作因子计，学会看懂趋势。
2. **共振时代**: 建造共振器，获得被动能源。
3. **干涉者时代**: 制造激荡器，进行小规模波动控制。
4. **维度时代**: 跨维度传输，形成“采集-稳压-转化”链。
5. **塑造者时代**: 建造世界级建筑，永久改变区域属性。
6. **仲裁者时代**: 参与服务器级潮汐治理事件，决定世界走向。

### 7.1 新手引导任务链（可直接落地）

* 任务 01：记录一天内 4 次 Factor 读数。
* 任务 02：在低能阶段完成一次高成功率精密合成。
* 任务 03：在高能阶段生存 3 分钟并击败潮涌体。
* 任务 04：搭建首个稳定锚并维持 10 分钟稳定区。
* 任务 05：完成一次跨维度能量引流。


### 7.2 材料等级设定（对齐匠魂风格）

采用“采集等级 + 韧性/耐久 + 特性词条”的材料体系，配合阶段推进逐步开放。

| 阶段 | 材料等级 | 代表材料 | 匠魂风格定位 | 解锁内容 |
| :--- | :--- | :--- | :--- | :--- |
| 早期（观察者/共振） | **Lv1 粗坯级** | 铜、青铜、石英强化木芯 | 入门工具，低门槛改造 | 因子计、基础共振器、简易稳压件 |
| 中前期（干涉者） | **Lv2 工业级** | 铁、下界石钢、玫瑰金系 | 平衡型，耐久与速度兼顾 | 激荡器、并行处理仓、低阶多方块 |
| 中后期（维度） | **Lv3 维度级** | 钴、阿迪特、玛玉灵（Manyullyn） | 高性能，带维度词条 | 裂隙织机、跨维度传输核心 |
| 后期（塑造者） | **Lv4 远古级** | 远古合金、星辉晶、虚序复合材 | 极限词条与专精路线 | 世界稳定器、高阶模块槽全开 |
| 终局（仲裁者） | **Lv5 仲裁级** | 仲裁回响残片、零熵结晶 | 规则改写型材料 | 终极反应釜、结局向巨构装置 |

材料属性建议包含：
* **采集等级（Harvest Tier）**：限制可开采矿脉与可加工配方。
* **韧性（Toughness）**：影响多方块故障耐受，替代单一“耐久条”。
* **导因率（Factor Conductivity）**：决定机器输入上限与波动损耗。
* **词条（Traits）**：如“炽热”“静默”“共鸣”，与维度/阶段强绑定。

通过此分级，玩家会自然经历“工具升级 → 设备升级 → 结构升级”的匠魂式成长曲线。

---

## 8. 多人协作与服务器玩法

### 8.1 角色分工

* **观测员**：负责预测潮汐窗口、广播预警。
* **工程师**：维护稳压网络与核心产线。
* **清道夫**：处理污染与灾后修复。
* **远征者**：在高风险时段获取稀有材料。

### 8.2 服务器公共事件

* **全服失稳警报**：要求玩家共同降压，成功后给予公共 Buff。
* **维度竞速周**：在限定时间内看哪个队伍能产出最多“稳定价值”。
* **裂隙攻防战**：团队守住中继塔，避免过载怪潮突破。

---

## 9. 平衡与反滥用建议

* 单机与多人使用不同参数模板（多人加大阻尼，降低单队垄断能力）。
* 对“无限稳态”构筑引入维护成本（材料磨损、定期校准）。
* 对“无限过载刷怪”引入收益衰减，鼓励切换玩法。
* 关键产出受“近期行为多样性”影响，防止单一套路最优解。

---

## 10. 技术架构 (Fabric)

### 10.1 数据存储
* 使用 Fabric 的 `PersistentState` 保存维度 Factor 数据。
* 每个维度 (`ServerWorld`) 独立拥有一个 `FactorWorldState`。
* 新增 `DayTierSnapshot`：记录当日均值、趋势、迟滞参数和次日生效 Tier。
* 额外保存：
  * 历史窗口缓存（用于 HUD 曲线）
  * 区块级污染热度图
  * 事件冷却与触发计数

### 10.2 同步机制
* S2C Packet: 每当 Factor 变化超过阈值（如 1.0）或定时（每秒），向维度内玩家发送更新包。
* Client: 渲染 HUD 显示当前 Factor、趋势箭头、下一阈值预估时间。
* 多人优化：按“关注区块”增量同步，避免全量广播。

### 10.3 API 设计
* `FactorAPI.getFactor(World world)`
* `FactorAPI.addFactorOffset(World world, double offset, int duration)`
* `FactorAPI.getTier(World world)`
* `FactorAPI.predictCrossing(World world, double targetFactor)`
* 事件系统：
  * `FactorChangeEvent`（实时）
  * `FactorTierChangeEvent`（仅日切触发）
  * `FactorThresholdEvent`（日切统一结算）
  * `FactorDisasterEvent`

### 10.4 数据驱动建议

建议把以下配置 JSON 化，便于整合包调参：
* 各维度基准值、振幅、阻尼、噪声。
* 阈值效果与触发概率。
* 机器模块参数与收益曲线。
* 服务器事件时间表与奖励池。

---

## 11. 里程碑建议（开发侧）

* **M1（可玩原型）**：全局 Factor + HUD + 5 档状态效果。
* **M2（功能闭环）**：因子计、共振器、稳定锚、激荡器。
* **M3（维度联动）**：下界/末地参数差异 + 跨维度设备。
* **M4（内容扩展）**：敌怪、污染、服务器公共事件。
* **M5（长期运营）**：阵营线、结局分歧、数据驱动平衡工具。

---

## 12. 一句话设计目标

> 让玩家始终在“现在就收割风险红利”与“为未来维持世界稳定”之间做选择，并且这个选择可被看见、可被协作、可被世界反馈。

# Factor Craft 核心设计文档

## 1. 核心概念：Factor (因子)

Factor 是某种充斥在维度中的能量或法则的具象化数值。它不是静态的，而是像潮汐一样随着世界时间（World Time）不断波动。

### 1.1 数值模型
Factor 值 $F(t)$ 是一个维度全局的浮点数值，通常范围在 $[0, 100]$ 之间，但也可能溢出或下溢（代表极端危险状态）。

计算公式原型：
$$ F(t) = F_{base} + F_{tide}(t) + F_{player} + F_{random} $$

*   $F_{base}$: 维度的基准值（例如主世界 50，下界 80，末地 20）。
*   $F_{tide}(t)$: 潮汐波动，通常是一个复合正弦波函数。
    *   $$ A \cdot \sin(\frac{t}{T} \cdot 2\pi) $$
    *   $A$: 振幅 (Amplitude)
    *   $T$: 周期 (Period)，例如 24000 tick (一天) 或更长。
*   $F_{player}$: 玩家设施产生的偏移量总和。
*   $F_{random}$: 随机扰动/噪声。

### 1.2 状态划分 (Factor Tiers)

根据 Factor 的当前值，维度处于不同的状态：

| 范围 | 状态名称 | 描述 | 环境影响 (Cons) | 玩家收益 (Pros) |
| :--- | :--- | :--- | :--- | :--- |
| < 10 | **枯竭 (Depleted)** | 能量极度匮乏 | 魔法机器停转，作物生长停滞 | **安全期**：怪物生成率降至 0，敌对生物变中立，适合建筑和维护 |
| 10 - 30 | **低能 (Low)** | 能量稀薄 | 机器效率降低 (-50%) | 精密操作成功率提升，燃料消耗降低 |
| 30 - 70 | **稳定 (Stable)** | 正常水平 | 无特殊影响 | 标准合成效率 |
| 70 - 90 | **高能 (High)** | 能量充盈 | 敌对生物获得 Buff，偶尔出现环境辐射（需防护） | 机器效率提升 (+50%)，产出增加 |
| > 90 | **过载 (Overload)** | 能量暴走 | 频繁生成元素怪物，玩家受到持续魔力压制（Debuff） | **奇迹时刻**：允许进行神级注魔，产出翻倍，稀有掉落率 100% |

## 2. 核心玩法循环

### 阶段 1: 适应 (Survival)
*   玩家进入游戏，Factor 处于自然潮汐状态。
*   玩家需要制作基础工具 `Factorometer` (因子计) 来观测当前的 Factor 值。
*   **策略**：在 Factor 高时通过战斗获取资源，在 Factor 低时进行探索或种田（如果设计为低 Factor 适合种田的话，或者反之）。
*   **挑战**：Factor 过高时的环境伤害或强力怪物。

### 阶段 2: 交互 (Interaction)
*   玩家制造基础机器。
*   **Factor Consumer (因子消耗器)**：利用高 Factor 进行生产（如矿物倍增），但这会局部或全局降低 Factor。
*   **Factor Accumulator (因子收集器)**：在低 Factor 时释放储存的能量来维持机器运行。

### 阶段 3: 掌控 (Control)
*   玩家制造大型多方块结构。
*   **World Stabilizer (维度稳定器)**：消耗大量资源，将维度的 Factor 锁定在特定范围。
*   **Tide Agitator (潮汐激荡器)**：人为制造“Factor 巨浪”，瞬间将 Factor 推至极高值以进行终极合成，随后可能导致长时间的“枯竭期”。

## 4. 维度差异性设计 (Dimensional Variance)

Factor 不仅仅是一个通用的数值，它在不同维度表现出截然不同的物理性质。

### 4.1 主世界 (The Overworld) - 谐波 (Harmonic)
*   **特性**: 完美的正弦波，周期稳定（与日夜交替同步）。
*   **关键词**: 平衡、循环、生命。
*   **Factor 曲线**: 平滑，无突变。
*   **适宜活动**: 基础自动化、农业加速、稳定充能。
*   **环境影响**: 
    *   高 Factor: 作物生长极快，被动生物繁殖加速。
    *   低 Factor: 类似冬季，作物休眠。

### 4.2 下界 (The Nether) - 混沌 (Chaotic)
*   **特性**: 剧烈波动，平均值较高，伴随随机的能量尖峰 (Spikes)。
*   **关键词**: 爆发、危险、热能。
*   **Factor 曲线**: 锯齿状，不可预测，偶尔出现极值（Overload）。
*   **适宜活动**: 快速充能（需稳压设备）、高能合成、获取稀有战斗掉落物。
*   **环境影响**: 
    *   高 Factor: 熔岩流动速度加快，火焰伤害加倍，猪灵狂暴。
    *   低 Factor: 灵魂沙减速效果增强，视野变暗。

### 4.3 末地 (The End) - 虚空 (Void)
*   **特性**: 极低基准值，几乎静滞，对外界干扰反应迟钝（高阻尼）。
*   **关键词**: 寂静、存储、熵增。
*   **Factor 曲线**: 近乎直线，极难自然恢复。
*   **适宜活动**: 长期能量存储（低泄漏）、危险废料排放（消除过剩 Factor）、精密实验（无干扰）。
*   **环境影响**: 
    *   高 Factor (人为): 末影人瞬移频率极高，可能导致虚空伤害。
    *   低 Factor: 重力减弱（跳跃提升）。

## 5. 魔法科技体系 (Techno-Magic System)

本模组不使用传统的线缆和管道，而是采用“场”与“流”的概念。

### 5.1 传输介质
1.  **晶体共振 (Resonance)**: 短距离无线传输。在机器插槽中放入调谐过的晶体，与附近的 `Pylon` (塔) 共振。
2.  **以太光束 (Ether Beam)**: 长距离点对点传输。使用透镜 (Lens) 折射光束。光束穿过实体会造成效果。
3.  **相位管道 (Phase Duct)**: 仅用于输送高浓度的液态 Factor (用于顶级合成)。

### 5.2 核心设备
*   **Factorometer (因子计)**: 类似指南针，指针指向当前的 Factor 强度，或显示波形。
*   **Resonator (共振器)**: 基础发电机。利用自然 Factor 的波动差发电（RF/FE），类似潮汐能发电。
*   **Stabilizer (稳定锚)**: 多方块结构。消耗大量能量，将区块内的 Factor 锁定。
*   **Rift Projector (裂隙投射器)**: 终极设备。将下界的混沌 Factor 投射到主世界，或者将末地的虚空属性引入局部区域，创造“人造生物群系”。

## 6. 发展路线 (Progression)

1.  **观察者时代**: 制作因子计，寻找高 Factor 时机进行附魔或收割。
2.  **共振时代**: 建造共振器，利用自然潮汐获取被动能源。
3.  **干涉者时代**: 制造“激荡器”，人为制造小规模 Factor 波动以驱动机器。
4.  **维度时代**: 跨维度传输能量，利用下界的高能和末地的稳定。
5.  **塑造者时代**: 建造世界级建筑，永久改变维度的 Factor 属性（如将一片区域永久定格在“丰饶之春”）。

## 7. 技术架构 (Fabric)

### 7.1 数据存储
*   使用 Fabric 的 `PersistentState` 保存维度的 Factor 数据。
*   每个维度 (`ServerWorld`) 独立拥有一个 `FactorWorldState`。

### 7.2 同步机制
*   S2C Packet: 每当 Factor 变化超过阈值（如 1.0）或定时（每秒），向维度内所有玩家发送 Factor 更新包。
*   Client: 渲染 HUD 显示当前 Factor 波形图。

### 7.3 API 设计
*   `FactorAPI.getFactor(World world)`
*   `FactorAPI.addFactorOffset(World world, double offset, int duration)`
*   事件系统: `FactorChangeEvent`, `FactorTierChangeEvent`。
